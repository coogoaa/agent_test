# 完整PVGIS模拟器 - 配置参数说明

## ✅ 已包含的所有财务因素

### 1. 每日固定费用 ✅
- **参数**: `fixed_charge_day` (默认: $0.80/天)
- **位置**: `self.tariff['fixed_charge_day']`
- **计算**: 每月费用 = 固定费用 × 当月天数
- **体现在**: 购电费用和无太阳能电费中

### 2. 电费通货膨胀 ✅
- **参数**: `price_indexation` (默认: 2.5%/年)
- **位置**: `self.tariff['price_indexation']`
- **计算**: 年度因子 = (1 + 通胀率)^年份
- **应用**: 电价和固定费用都会随年份增长

### 3. 贴现率 ✅
- **参数**: `discount_rate` (默认: 5.0%/年)
- **位置**: `self.finance['discount_rate']`
- **计算**: 贴现因子 = 1 / (1 + 贴现率)^(年份 + 月份/12)
- **用途**: 计算NPV（净现值）和贴现回本期

---

## 📊 输出数据说明

### CSV文件列（20列）
1. **年份** - 1-20
2. **月份** - 1-12
3. **发电(kWh)** - 月度总发电量
4. **用电(kWh)** - 月度总用电量
5. **直接自用(kWh)** - 发电时即时消耗
6. **电池放电(kWh)** - 电池供电量
7. **上网(kWh)** - 卖给电网的电量
8. **购电(kWh)** - 从电网购买的电量
9. **自用率(%)** - (直接自用 + 电池放电) / 发电量
10. **购电费($)** - 包含购电量费用 + 固定费用
11. **馈网收入($)** - 上网电量 × 上网电价
12. **净电费($)** - 购电费 - 馈网收入
13. **无太阳能电费($)** - 假设没有太阳能的电费（含固定费用）
14. **月节省($)** - 无太阳能电费 - 净电费（名义值）
15. **贴现因子** - 当月的贴现系数
16. **贴现后节省($)** - 月节省 × 贴现因子
17. **累计节省($)** - 名义值累计
18. **累计贴现后节省($)** - 贴现值累计
19. **回本进度(%)** - 累计节省 / 投资额 × 100
20. **贴现回本进度(%)** - 累计贴现后节省 / 投资额 × 100

### JSON文件结构
```json
{
  "metadata": {
    "location": {...},
    "system": {...},
    "tariff": {
      "electricity_price_kwh": 0.35,
      "feed_in_tariff": 0.06,
      "fixed_charge_day": 0.8,        // ← 每日固定费用
      "price_indexation": 0.025       // ← 电费通胀率
    },
    "finance": {
      "upfront_investment": 18000.0,
      "subsidy": 2500.0,
      "final_price": 15500.0,
      "discount_rate": 0.05            // ← 贴现率
    }
  },
  "summary": {
    "total_20year_saving_nominal": 48581.27,      // 名义值总节省
    "total_20year_saving_discounted": 28567.86,   // 贴现值总节省
    "npv": 13067.86,                              // 净现值
    "payback_period_years_nominal": 8.33,         // 名义回本期
    "payback_period_years_discounted": 10.5       // 贴现回本期
  }
}
```

---

## 🔧 如何修改配置参数

### 方法1: 直接编辑代码
编辑 `完整PVGIS集成模拟器.py` 第63-77行：

```python
# 电价配置（SA州）
self.tariff = {
    'electricity_price_kwh': Decimal('0.35'),    # 购电单价 $/kWh
    'feed_in_tariff': Decimal('0.06'),           # 上网电价 $/kWh
    'fixed_charge_day': Decimal('0.80'),         # 日固定费用 $/天 ← 修改这里
    'price_indexation': Decimal('0.025'),        # 电费通胀率 2.5%/年 ← 修改这里
}

# 财务配置
self.finance = {
    'upfront_investment': Decimal('18000'),      # 初始投资
    'subsidy': Decimal('2500'),                  # 补贴
    'final_price': Decimal('15500'),             # 净投资
    'discount_rate': Decimal('0.05'),            # 贴现率 5%/年 ← 修改这里
}
```

### 方法2: 创建配置文件（推荐）
我可以为您创建一个支持外部配置文件的版本，例如：

```python
# config.json
{
  "tariff": {
    "electricity_price_kwh": 0.35,
    "feed_in_tariff": 0.06,
    "fixed_charge_day": 0.80,
    "price_indexation": 0.025
  },
  "finance": {
    "discount_rate": 0.05
  }
}
```

然后运行：
```bash
python3 完整PVGIS集成模拟器.py --config config.json
```

---

## 📈 财务指标详解

### 1. 名义值 vs 贴现值
- **名义值**: 未考虑货币时间价值，直接累加
- **贴现值**: 考虑货币时间价值，未来的钱折算到现在

### 2. NPV（净现值）
```
NPV = 累计贴现后节省 - 初始投资
```
- NPV > 0: 项目有利可图
- NPV = 0: 项目刚好盈亏平衡
- NPV < 0: 项目不划算

### 3. 回本周期
- **名义回本期**: 不考虑贴现，累计节省达到投资额的时间
- **贴现回本期**: 考虑贴现，累计贴现后节省达到投资额的时间

---

## 💡 示例计算

### 第1年第1月（31天）
```
配置:
- 电价: $0.35/kWh
- 固定费用: $0.80/天
- 通胀率: 2.5%/年
- 贴现率: 5.0%/年

计算:
1. 年度因子 = (1 + 0.025)^1 = 1.025
2. 购电费 = 0 × 0.35 × 1.025 + 31 × 0.80 = $24.80
3. 馈网收入 = 253.96 × 0.06 = $15.24
4. 净电费 = 24.80 - 15.24 = $9.56
5. 无太阳能电费 = 423.20 × 0.35 × 1.025 + 31 × 0.80 = $176.62
6. 月节省 = 176.62 - 9.56 = $167.06
7. 贴现因子 = 1 / (1 + 0.05)^1 = 0.9524
8. 贴现后节省 = 167.06 × 0.9524 = $159.11
```

### 第20年第12月（31天）
```
计算:
1. 年度因子 = (1 + 0.025)^20 = 1.6386
2. 购电费 = 0 × 0.35 × 1.6386 + 31 × 0.80 = $24.80
3. 月节省 = 约 $200 (电价上涨)
4. 贴现因子 = 1 / (1 + 0.05)^20 = 0.3769
5. 贴现后节省 = 200 × 0.3769 = $75.38
```

---

## 🎯 当前配置总结

### 默认配置
| 参数 | 值 | 说明 |
|------|-----|------|
| 购电单价 | $0.35/kWh | SA州平均电价 |
| 上网电价 | $0.06/kWh | 馈网补贴 |
| **日固定费用** | **$0.80/天** | **每日供电服务费** |
| **电费通胀率** | **2.5%/年** | **电价年增长率** |
| **贴现率** | **5.0%/年** | **货币时间价值** |
| 系统容量 | 6.6 kW | 光伏系统 |
| 电池容量 | 13.5 kWh | 储能系统 |
| 初始投资 | $15,500 | 扣除补贴后 |

### 20年财务结果
| 指标 | 名义值 | 贴现值 |
|------|--------|--------|
| 总节省 | $48,581 | $28,568 |
| 回本周期 | 8.33年 | 10.50年 |
| 回本进度 | 313.4% | 184.3% |
| NPV | - | **$13,068** |

---

## ⚠️ 重要说明

1. ✅ **每日固定费用已包含** - 在购电费和无太阳能电费中都有计算
2. ✅ **电费通胀已包含** - 电价和固定费用都会逐年增长
3. ✅ **贴现率已包含** - 提供名义值和贴现值两套完整数据
4. ✅ **所有参数可配置** - 可直接修改代码或使用配置文件

---

**更新时间**: 2025-10-24  
**版本**: v2.0 (完整财务版)

# 20年财务计算模拟数据 - 使用指南

## 📁 生成的文件清单

### 1. `financial_simulation_240months.json`
**用途**: 完整的240个月JSON格式数据  
**适合**: 程序化分析、API调用、前端展示  
**包含内容**:
- 元数据（metadata）
- 项目总结（summary）
- 240个月逐月数据（monthly_data）

**数据结构示例**:
```json
{
  "metadata": {
    "generated_at": "2025-10-24T21:00:53",
    "description": "20年240个月太阳能系统财务模拟数据",
    "total_months": 240
  },
  "summary": {
    "project_info": { ... },
    "performance_20years": {
      "total_generation_kwh": 231095.17,
      "total_saving": 65991.67,
      "payback_period_years": 5.15,
      "irr_percent": 16.88
    }
  },
  "monthly_data": [ ... ]
}
```

---

### 2. `财务数据_240个月.csv`
**用途**: Excel可读的表格数据  
**适合**: 数据透视表、图表制作、手动分析  
**列说明**:

| 列名 | 说明 | 单位 |
|------|------|------|
| 年份 | 1-20 | - |
| 月份 | 1-12 | - |
| 天数 | 该月天数 | 天 |
| 发电量 | 月度发电量 | kWh |
| 用电量 | 月度用电量 | kWh |
| 直接自用 | 发电时即时消耗 | kWh |
| 上网 | 卖给电网的电量 | kWh |
| 购电 | 从电网买的电量 | kWh |
| 自用率 | 自用占发电比例 | % |
| 购电费用 | 当月购电成本 | $ |
| 馈网收入 | 卖电收入 | $ |
| 净电费 | 购电-卖电 | $ |
| 无太阳能电费 | 假设无系统的电费 | $ |
| 月度节省 | 当月节省金额 | $ |
| 累计节省 | 从第1个月累计至今 | $ |
| 回本进度 | 累计节省/净投资 | % |

**使用建议**:
- 在Excel中打开，创建数据透视表
- 绘制趋势图：发电量、节省额、回本进度
- 筛选特定年份或月份查看详情

---

### 3. `数据分析报告.md`
**用途**: 详细的分析报告和洞察  
**适合**: 理解数据、决策参考、展示给客户  
**包含内容**:
- 📊 项目概述
- 💰 20年财务绩效总结
- 📈 分年度数据趋势
- 📅 月度数据示例
- 🔍 关键洞察
- 🎯 结论与建议

---

### 4. `financial_simulator.py`
**用途**: Python模拟器源代码  
**适合**: 自定义参数重新模拟、理解计算逻辑  

**如何使用**:
```bash
# 直接运行生成默认参数的数据
python3 financial_simulator.py

# 修改参数重新模拟
# 1. 打开 financial_simulator.py
# 2. 修改 __init__ 方法中的 self.config 或 self.project 参数
# 3. 重新运行
```

**可修改的关键参数**:
```python
# 电价参数
'electricity_price_per_kwh': Decimal('0.30'),  # 购电单价
'feed_in_tariff': Decimal('0.05'),  # 上网电价
'fixed_charge_day': Decimal('0.50'),  # 日固定费用

# 系统参数
'price_indexation': Decimal('0.025'),  # 电价膨胀率
'panel_degradation': Decimal('0.004'),  # 发电衰减率

# 项目配置
'system_size_kw': Decimal('10.0'),  # 系统容量
'battery_capacity_kwh': Decimal('5.0'),  # 电池容量
'upfront_investment': Decimal('20000'),  # 前期投资
'final_price': Decimal('17000'),  # 净投资
```

---

## 🚀 快速开始

### 查看概览
1. 打开 `数据分析报告.md` 了解整体情况
2. 重点关注"20年财务绩效总结"部分

### Excel分析
1. 用Excel打开 `财务数据_240个月.csv`
2. 创建数据透视表：
   - 行：年份
   - 值：累计节省、发电量、购电量
3. 插入折线图显示趋势

### 编程分析
```python
import json

# 读取数据
with open('financial_simulation_240months.json', 'r') as f:
    data = json.load(f)

# 获取总结信息
summary = data['summary']
print(f"回本周期: {summary['performance_20years']['payback_period_years']}年")
print(f"IRR: {summary['performance_20years']['irr_percent']}%")

# 获取特定月份数据
month_data = data['monthly_data'][0]  # 第1个月
print(f"第{month_data['year']}年{month_data['month']}月发电量: {month_data['generation_kwh']} kWh")
```

---

## 📊 关键数据速查

### 投资回报
- **净投资**: $17,000
- **回本周期**: 5.15年
- **20年总收益**: $65,991.67
- **纯利润**: $48,991.67
- **IRR**: 16.88%

### 能源绩效
- **总发电量**: 231,095 kWh
- **自用率**: 70%
- **购电减少**: 89.1%
- **碳减排**: ~173吨CO₂

### 年度趋势
| 年份 | 发电量(kWh) | 累计节省($) | 回本进度 |
|------|-------------|-------------|----------|
| 1 | 12,000 | 3,374 | 19.8% |
| 5 | 11,809 | 18,613 | **已回本** ✅ |
| 10 | 11,530 | 40,889 | 纯收益$23,889 |
| 20 | 11,078 | 65,992 | 纯收益$48,992 |

---

## 🔧 自定义模拟

### 场景1: 更大系统（15kW）
修改 `financial_simulator.py`:
```python
'system_size_kw': Decimal('15.0'),
'panel_count': 38,
'upfront_investment': Decimal('28000'),
'final_price': Decimal('24000'),
```

### 场景2: 无电池系统
```python
'battery_capacity_kwh': Decimal('0.0'),
# 自用率会自动降至40%
```

### 场景3: 不同电价
```python
'electricity_price_per_kwh': Decimal('0.35'),  # 更高电价
'feed_in_tariff': Decimal('0.08'),  # 更高上网电价
```

---

## ⚠️ 重要说明

### 数据准确性
✅ **已验证**:
- 财务计算逻辑（基于原Java代码）
- 衰减率、膨胀率模型
- IRR、回本期计算

⚠️ **简化假设**:
- 月度用电量恒定（实际有波动）
- 发电量按理论值估算（实际受天气影响）
- 未包含维护成本
- 未包含第10年电池更换成本

### 建议
1. 结合实际场地的发电数据校准
2. 考虑增加5-10%的维护成本预算
3. 电池更换成本需另外规划（约$5,000）

---

## 📞 技术支持

### 问题排查
**问题**: CSV文件乱码  
**解决**: 用Excel打开时选择"UTF-8"编码

**问题**: 想修改参数重新模拟  
**解决**: 编辑 `financial_simulator.py`，修改参数后运行：
```bash
python3 financial_simulator.py
python3 export_csv.py
```

**问题**: JSON数据如何读取  
**解决**: 使用Python的json库或在线JSON查看器

---

## 📚 延伸阅读

### 相关文档
- `20.md`: Java原始代码逻辑
- `moni.md`: 代码逻辑分析和示例

### 计算公式参考
- **月发电量**: 系统容量 × 年发电小时数 × 月度占比 × 衰减因子
- **自用率**: (直接自用 + 电池放电) / 发电量
- **月节省**: 无太阳能电费 - (购电费用 - 馈网收入)
- **回本期**: 净投资 / 年均节省
- **IRR**: 使现金流NPV=0的折现率

---

**最后更新**: 2025-10-24  
**版本**: v1.0  
**作者**: 财务模拟器

# 电池更换计提 - 详细说明

## ✅ 已实现功能

### 电池更换成本计提
采用**直线法**将电池更换成本平均分摊到电池寿命期内的每个月。

---

## 📊 计提方法

### 计算公式
```
月度计提金额 = 电池更换成本 / (电池寿命年数 × 12)
```

### 默认配置
```python
battery_replacement_cost = $8,000    # 电池更换成本
battery_lifespan_years = 10          # 电池寿命（年）
lifespan_months = 10 × 12 = 120      # 电池寿命（月）

月度计提 = $8,000 / 120 = $66.67/月
```

### 20年总计提
```
20年 = 240个月
20年总计提 = $66.67 × 240 = $16,000

说明：
- 前10年（120个月）：为第1次电池更换计提 $8,000
- 后10年（120个月）：为第2次电池更换计提 $8,000
- 总计：$16,000
```

---

## 💰 财务影响

### 对比：有无电池计提

| 指标 | 不含电池计提 | 含电池计提 | 差异 |
|------|-------------|-----------|------|
| **20年总节省（名义值）** | $48,581 | $32,581 | -$16,000 |
| **回本周期（名义值）** | 8.33年 | 12.08年 | +3.75年 |
| **NPV（净现值）** | $13,068 | $3,317 | -$9,751 |
| **贴现回本周期** | 10.50年 | 16.92年 | +6.42年 |

### 关键发现
1. **电池成本显著影响回本期** - 从8.33年延长到12.08年
2. **NPV仍为正值** - $3,317 > 0，项目仍然可行
3. **20年总计提 = 2次电池更换** - $16,000（每次$8,000）

---

## 📈 月度成本构成

### 第1年第1月示例
```
购电费: $24.80
馈网收入: $15.24
净电费: $9.56
电池计提: $66.67  ← 新增
净成本含电池: $76.23
无太阳能电费: $176.62
月节省: $100.39  (之前是$167.06)
```

### 计算过程
```
净成本含电池 = 净电费 + 电池计提
             = $9.56 + $66.67
             = $76.23

月节省 = 无太阳能电费 - 净成本含电池
       = $176.62 - $76.23
       = $100.39
```

---

## 🔧 如何修改配置

### 方法1: 直接编辑代码
编辑 `完整PVGIS集成模拟器.py` 第43-44行：

```python
self.system = {
    ...
    'battery_replacement_cost': Decimal('8000'),  # ← 修改电池成本
    'battery_lifespan_years': 10,                 # ← 修改电池寿命
}
```

### 方法2: 不同场景配置

#### 场景A: 高端电池（更贵但更耐用）
```python
'battery_replacement_cost': Decimal('10000'),  # $10,000
'battery_lifespan_years': 15,                  # 15年
# 月度计提 = $10,000 / 180 = $55.56/月
```

#### 场景B: 经济型电池（便宜但寿命短）
```python
'battery_replacement_cost': Decimal('6000'),   # $6,000
'battery_lifespan_years': 8,                   # 8年
# 月度计提 = $6,000 / 96 = $62.50/月
```

#### 场景C: 无电池系统
```python
'battery_replacement_cost': Decimal('0'),      # $0
'battery_lifespan_years': 20,                  # 任意值
# 月度计提 = $0 / 240 = $0/月
```

---

## 📊 CSV数据说明

### 新增列（第12-13列）
```
12. 电池计提($) - 每月固定 $66.67
13. 净成本含电池($) - 净电费 + 电池计提
```

### 完整列表（22列）
1. 年份
2. 月份
3. 发电(kWh)
4. 用电(kWh)
5. 直接自用(kWh)
6. 电池放电(kWh)
7. 上网(kWh)
8. 购电(kWh)
9. 自用率(%)
10. 购电费($)
11. 馈网收入($)
12. 净电费($)
13. **电池计提($)** ← 新增
14. **净成本含电池($)** ← 新增
15. 无太阳能电费($)
16. 月节省($) - 已考虑电池计提
17. 贴现因子
18. 贴现后节省($)
19. 累计节省($)
20. 累计贴现后节省($)
21. 回本进度(%)
22. 贴现回本进度(%)

---

## 🎯 实际应用场景

### 场景1: 第10年电池更换
```
前120个月：每月计提 $66.67
第120个月累计：$8,000

实际操作：
- 第10年末支付 $8,000 更换电池
- 前10年已通过计提预留了这笔费用
- 现金流平滑，无突然大额支出
```

### 场景2: 第20年电池更换
```
第121-240个月：继续每月计提 $66.67
第240个月累计：$16,000

实际操作：
- 第20年末可能需要再次更换电池
- 或者系统到期，不再更换
- 计提金额可视为电池折旧成本
```

---

## 💡 计提的优势

### 1. 真实成本反映
- 不计提：回本期8.33年（过于乐观）
- 计提后：回本期12.08年（更真实）

### 2. 现金流平滑
- 避免第10年突然支出$8,000
- 每月$66.67更容易承受

### 3. 财务规划
- 清楚知道真实的投资回报
- 便于与其他投资方案对比

### 4. 风险管理
- 预留电池更换资金
- 降低未来财务压力

---

## 📝 验证示例

### 第1年第1月
```
净电费: $9.56
电池计提: $66.67
净成本含电池: $9.56 + $66.67 = $76.23 ✅
月节省: $176.62 - $76.23 = $100.39 ✅
```

### 第10年第12月（累计120个月）
```
累计电池计提: $66.67 × 120 = $8,000 ✅
说明：已为第1次电池更换预留足够资金
```

### 第20年第12月（累计240个月）
```
累计电池计提: $66.67 × 240 = $16,000 ✅
说明：已为2次电池更换预留足够资金
```

---

## ⚠️ 重要说明

### 1. 计提 ≠ 实际支付
- 计提是会计概念，用于成本分摊
- 实际支付发生在第10年、第20年
- 但财务分析中应考虑计提成本

### 2. 电池价格可能变化
- 当前配置：$8,000
- 未来可能更便宜（技术进步）
- 也可能更贵（通货膨胀）
- 建议定期更新配置

### 3. 电池寿命因素
- 理论寿命：10年
- 实际寿命受使用强度影响
- 充放电循环次数
- 环境温度等因素

### 4. 不同电池类型
- 磷酸铁锂（LiFePO4）：寿命长，价格高
- 三元锂（NMC）：性能好，成本适中
- 铅酸电池：便宜，寿命短

---

## 🔄 更新历史

### v2.1 (2025-10-24)
- ✅ 新增电池更换成本计提
- ✅ 采用直线法月度分摊
- ✅ 电池成本和寿命可配置
- ✅ CSV新增2列（电池计提、净成本含电池）
- ✅ 财务结果已包含电池成本

---

## 📞 配置建议

### 保守估计（推荐）
```python
'battery_replacement_cost': Decimal('8000'),   # 略高估计
'battery_lifespan_years': 10,                  # 保守估计
```

### 乐观估计
```python
'battery_replacement_cost': Decimal('6000'),   # 价格下降
'battery_lifespan_years': 12,                  # 寿命延长
```

### 悲观估计
```python
'battery_replacement_cost': Decimal('10000'),  # 价格上涨
'battery_lifespan_years': 8,                   # 寿命缩短
```

---

**更新时间**: 2025-10-24  
**版本**: v2.1 (含电池计提)  
**电池计提**: $66.67/月 × 240月 = $16,000

# 太阳能投资回报模拟器 - 版本对比

本项目提供三个版本的太阳能投资回报计算器，分别采用不同的电池成本处理方式和计算粒度。

## 版本列表

### 1. 原始版本 (index.html)
**文件**: `index.html`, `calculator.js`, `ui.js`

**特点**:
- ✅ 第10年一次性扣除电池更换成本 ($5,000)
- ✅ 按年计算回本周期 (20年循环)
- ✅ IRR 基于实际现金流

**电池成本处理**:
```
第1-9年:  年度净节省 = 基础节省
第10年:   年度净节省 = 基础节省 - $5,000
第11-20年: 年度净节省 = 基础节省
```

**适用场景**:
- 需要真实反映现金流的财务分析
- 第10年确实需要支付电池更换费用
- 符合传统财务报表习惯

---

### 2. 计提法年度版本 (index-amortized-yearly.html)
**文件**: `index-amortized-yearly.html`, `calculator-amortized-yearly.js`, `ui-amortized-yearly.js`

**特点**:
- ✅ 前10年分摊电池成本 (每年 $500)
- ✅ 按年计算回本周期 (20年循环)
- ✅ 提供两种回本周期对比
- ✅ IRR 继续使用实际现金流

**电池成本处理**:
```
方式1 (第10年一次性):
  第1-9年:  年度净节省 = 基础节省
  第10年:   年度净节省 = 基础节省 - $5,000
  第11-20年: 年度净节省 = 基础节省

方式2 (计提法):
  第1-10年:  年度净节省 = 基础节省 - $500
  第11-20年: 年度净节省 = 基础节省
```

**KPI 指标** (7个):
1. 自用率
2. 回本周期 (简单) - 第10年一次性
3. 回本周期 (计提法) - 前10年分摊
4. 回本周期 (贴现) - 第10年一次性
5. 回本周期 (贴现+计提) - 前10年分摊
6. IRR - 基于实际现金流
7. 年发电量

**适用场景**:
- 需要平滑的累计节省曲线
- 会计角度的成本分摊
- 对比不同财务处理方式的影响

---

### 3. 计提法月度版本 (index-amortized-monthly.html) ⭐ 推荐
**文件**: `index-amortized-monthly.html`, `calculator-amortized-monthly.js`, `ui-amortized-monthly.js`

**特点**:
- ✅ 前120个月分摊电池成本 (每月 $41.67)
- ✅ 按月计算回本周期 (240个月循环)
- ✅ 结合月度发电和用电模型
- ✅ 考虑每月天数差异 (28-31天)
- ✅ 精确到月的回本周期
- ✅ IRR 基于年度汇总现金流

**电池成本处理**:
```
前120个月: 月度净节省 = 基础节省 - $41.67
第121-240月: 月度节省 = 基础节省
```

**月度能量流模型**:
- 每月使用对应的发电比例 (MONTHLY_GENERATION_PERCENTAGES)
- 每月使用对应的用电比例 (STATE_MONTHLY_CONSUMPTION_PERCENTAGES)
- 应用月度通胀系数: `(1 + 年通胀率)^(1/12)`
- 应用月度衰减系数: `(1 - 年衰减率)^(1/12)`
- 应用月度贴现系数: `(1 + 年贴现率)^(1/12)`

**KPI 指标** (4个):
1. 自用率
2. 回本周期 (月度计算) - 显示月数和年数
3. 回本周期 (贴现月度) - 显示月数和年数
4. IRR - 基于年度汇总
5. 年发电量

**计算示例** (默认参数):
```
电池成本: $5,000
月度分摊: $5,000 / 120 = $41.67/月

假设某月基础节省 $180:
  前120个月: 月度净节省 = $180 - $41.67 = $138.33
  第121-240月: 月度净节省 = $180
```

**适用场景**:
- 需要最精确的回本周期计算
- 考虑季节性发电和用电差异
- 月度财务报表和现金流管理
- 更符合实际运营情况

---

## 计算逻辑对比

| 特性 | 原始版本 | 计提法年度版本 | 计提法月度版本 ⭐ |
|------|---------|--------------|----------------|
| **循环次数** | 20次 (年) | 20次 (年) | 240次 (月) |
| **电池分摊** | 第10年一次性 | 前10年/年 | 前120月/月 |
| **分摊金额** | $5,000 (第10年) | $500/年 | $41.67/月 |
| **能量流模型** | 年度平均 | 年度平均 | 月度差异 |
| **回本周期精度** | 年 (小数) | 年 (小数) | 月 → 年 |
| **累计节省曲线** | 第10年下降 | 平滑上升 | 平滑上升 |
| **IRR 计算** | 实际现金流 | 实际现金流 | 年度汇总 |
| **计算复杂度** | 低 | 中 | 高 |
| **精确度** | 中 | 中 | 高 ⭐ |

---

## 使用建议

### 选择原始版本，如果:
- 需要符合传统财务报表的现金流分析
- 第10年确实需要一次性支付电池费用
- 不需要详细的月度分析

### 选择计提法年度版本，如果:
- 需要对比不同财务处理方式
- 希望看到平滑的累计节省曲线
- 按年度进行财务规划

### 选择计提法月度版本 ⭐，如果:
- 需要最精确的回本周期计算
- 关注季节性发电和用电差异
- 进行月度现金流管理
- 需要更符合实际运营的模拟

---

## 技术实现

### 核心模型
所有版本都基于相同的核心能量流模型:
- 12个月的发电比例
- 各州的月度和小时用电比例
- 电池充放电逻辑
- 自用率计算

### 差异点
1. **循环粒度**: 年 vs 月
2. **电池成本分摊**: 一次性 vs 年度 vs 月度
3. **通胀/衰减/贴现**: 年度系数 vs 月度系数
4. **回本周期计算**: 年度累加 vs 月度累加

---

## 文件结构

```
solar-calculator-static/
├── index.html                          # 原始版本
├── calculator.js                       # 原始版本计算逻辑
├── ui.js                              # 原始版本UI
├── index-amortized-yearly.html        # 计提法年度版本
├── calculator-amortized-yearly.js     # 年度计提计算逻辑
├── ui-amortized-yearly.js             # 年度计提UI
├── index-amortized-monthly.html       # 计提法月度版本 ⭐
├── calculator-amortized-monthly.js    # 月度计提计算逻辑
├── ui-amortized-monthly.js            # 月度计提UI
├── data.js                            # 共享数据 (所有版本)
├── README.md                          # 项目说明
└── VERSION_COMPARISON.md              # 本文件
```

---

## 默认参数

所有版本使用相同的默认参数:
- 州/领地: NSW (新南威尔士州)
- 年用电量: 5,662 kWh
- 光伏系统功率: 8 kWp
- 年发电系数: 1,526 kWh/kWp
- 电池容量: 10 kWh
- 总投资成本: $15,000
- 电价: $0.3/kWh
- 上网电价: $0.07/kWh
- 价格通胀率: 3.97%/年
- 光伏板年衰减率: 0.4%/年
- 日均固定费用: $0.35
- 电池更换成本: $5,000 (第10年)
- 贴现率: 1.36%

---

## 更新日志

### 2025-10-27
- ✅ 创建三个版本的独立文件
- ✅ 实现月度计算逻辑 (240个月循环)
- ✅ 实现月度电池成本分摊 (120个月)
- ✅ 添加版本对比文档

---

**推荐使用**: `index-amortized-monthly.html` ⭐ (最精确的月度计算版本)

# 版本对比：2023年版 vs 完整版

## 快速选择指南

```
需要2023年数据？ → 使用 pv_calculator_2023.py ✅ 推荐
需要历史数据？   → 使用 pv_calculator.py
不确定？        → 使用 pv_calculator_2023.py ✅ 推荐
```

---

## 详细对比表

| 特性 | 2023年版 | 完整版 |
|------|---------|--------|
| **脚本文件** | `pv_calculator_2023.py` | `pv_calculator.py` |
| **默认配置** | `config_australia.json` | `config.json` |
| **启动脚本** | `bash run.sh` | `python3 pv_calculator.py` |
| | | |
| **数据年份** | 仅2023年 ✅ | 所有可用年份(~19年) |
| **数据条数** | 8,760条 ✅ | ~166,536条 |
| **文件大小** | ~500KB ✅ | ~10MB |
| **处理速度** | 快 ✅ | 慢 |
| | | |
| **本地时间** | API原生支持 ✅ | 需要时区库 |
| **时区依赖** | 无需安装 ✅ | 需要 timezonefinder, pytz |
| **时间格式** | 本地时间 ✅ | UTC或本地时间 |
| | | |
| **输出目录** | 按经纬度分类 ✅ | 固定output/ |
| **目录示例** | `output/lat_41.1677S_lon_146.3473E/` | `output/` |
| **多地点管理** | 自动分类 ✅ | 需手动管理 |
| | | |
| **默认倾斜角** | 自动23度 ✅ | 需手动设置 |
| **JSON输出** | CSV + JSON双格式 ✅ | 仅JSON |
| **辐射数据** | CSV + JSON ✅ | 仅CSV |
| | | |
| **适用场景** | 最新数据评估 ✅ | 历史趋势分析 |
| **推荐度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## API参数对比

### Seriescalc API（小时辐射数据）

**2023年版**：
```python
params = {
    "lat": -41.1676875,
    "lon": 146.3472656,
    "startyear": 2023,        # ✅ 指定年份
    "endyear": 2023,          # ✅ 指定年份
    "pvcalculation": 0,
    "localtime": 1,           # ✅ 启用本地时间
    "outputformat": "json"
}
```

**完整版**：
```python
params = {
    "lat": -41.1676875,
    "lon": 146.3472656,
    # 无年份参数 - 返回所有年份
    "outputformat": "json"
}
```

---

## 输出文件对比

### 2023年版输出

```
output/
└── lat_41.1677S_lon_146.3473E/                    ✅ 按经纬度分类
    ├── hourly_radiation_2023_20251027_021306.csv  ✅ CSV格式
    ├── hourly_radiation_2023_20251027_021306.json ✅ JSON格式
    ├── results_2023_20251027_021306.json
    └── report_2023_20251027_021306.txt
```

### 完整版输出

```
output/
├── hourly_radiation_20251027_002956.csv           ❌ 无分类
├── results_20251027_002956.json                   ❌ 无JSON辐射数据
└── report_20251027_002956.txt
```

---

## 数据格式对比

### 小时辐射数据

**2023年版（本地时间）**：
```csv
time,G(i),H_sun,T2m,WS10m,Int
20230101:0030,687.75,61.0,21.36,4.48,0.0    ← 本地时间 ✅
20230101:0130,801.65,69.23,22.49,4.41,0.0
```

**完整版（UTC时间）**：
```csv
time,G(i),H_sun,T2m,WS10m,Int
20050101:0030,980.35,61.0,19.23,4.14,0.0    ← UTC时间
20050101:0130,1066.14,69.23,19.86,4.21,0.0
```

---

## 使用示例

### 场景1: 单个地点评估（推荐2023年版）

```bash
# 编辑配置文件
vim config_australia.json

# 运行（默认）
bash run.sh

# 或直接运行
python3 pv_calculator_2023.py config_australia.json
```

**优势**：
- ✅ 数据量小，处理快
- ✅ 本地时间，易读
- ✅ 自动分类输出

### 场景2: 多个地点批量计算（推荐2023年版）

```bash
python3 pv_calculator_2023.py location1.json
python3 pv_calculator_2023.py location2.json
python3 pv_calculator_2023.py location3.json
```

**输出自动分类**：
```
output/
├── lat_41.1677S_lon_146.3473E/    ← 地点1
├── lat_42.8821S_lon_147.3272E/    ← 地点2
└── lat_37.8136S_lon_144.9631E/    ← 地点3
```

### 场景3: 历史趋势分析（使用完整版）

```bash
python3 pv_calculator.py config.json
```

**优势**：
- ✅ 包含19年历史数据
- ✅ 可分析年际变化
- ✅ 评估长期趋势

---

## 性能对比

| 指标 | 2023年版 | 完整版 |
|------|---------|--------|
| **API请求时间** | ~5秒 | ~30秒 |
| **数据处理时间** | <1秒 | ~3秒 |
| **CSV文件大小** | ~500KB | ~10MB |
| **JSON文件大小** | ~800KB | ~15MB |
| **总处理时间** | ~10秒 ✅ | ~40秒 |

---

## 迁移指南

### 从完整版迁移到2023年版

1. **无需修改配置文件** - 两个版本使用相同的配置格式

2. **更新启动命令**：
   ```bash
   # 旧
   python3 pv_calculator.py config.json
   
   # 新
   python3 pv_calculator_2023.py config_australia.json
   # 或
   bash run.sh
   ```

3. **输出目录变化**：
   ```bash
   # 旧: output/
   # 新: output/lat_XXX_lon_XXX/
   ```

4. **时间格式变化**：
   - 旧: UTC时间（需要时区库转换）
   - 新: 本地时间（API原生支持）

---

## 常见问题

### Q: 我应该使用哪个版本？

**A**: 
- 99%的情况 → **2023年版** ✅
- 需要历史数据分析 → 完整版
- 不确定 → **2023年版** ✅

### Q: 2023年版能修改年份吗？

**A**: 可以！编辑脚本中的参数：
```python
params = {
    "startyear": 2022,  # 修改为你需要的年份
    "endyear": 2022,
    # ...
}
```

### Q: 两个版本可以同时使用吗？

**A**: 可以！它们互不干扰：
```bash
# 使用2023年版
python3 pv_calculator_2023.py config_australia.json

# 使用完整版
python3 pv_calculator.py config.json
```

### Q: 输出目录会冲突吗？

**A**: 不会！2023年版使用子目录分类：
```
output/
├── lat_41.1677S_lon_146.3473E/    ← 2023年版
├── hourly_radiation_*.csv         ← 完整版
└── results_*.json                 ← 完整版
```

---

## 推荐配置

### 日常使用（推荐）

```json
{
  "output": {
    "output_directory": "output",
    "add_timestamp": true
  }
}
```

使用脚本：`pv_calculator_2023.py` ✅

### 研究分析

```json
{
  "output": {
    "output_directory": "output_research",
    "add_timestamp": false
  }
}
```

使用脚本：`pv_calculator.py`（需要历史数据时）

---

## 总结

| 如果你需要... | 使用版本 |
|-------------|---------|
| 快速评估2023年发电量 | **2023年版** ✅ |
| 本地时间数据 | **2023年版** ✅ |
| 管理多个地点 | **2023年版** ✅ |
| 小文件大小 | **2023年版** ✅ |
| 历史趋势分析 | 完整版 |
| 年际变化研究 | 完整版 |

**默认推荐**: `pv_calculator_2023.py` ✅
